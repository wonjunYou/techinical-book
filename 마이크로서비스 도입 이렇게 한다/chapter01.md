## 더도 덜도 아닌 딱 마이크로서비스

### 마이크로서비스란?
* 비즈니스 도메인을 중심으로 모델링되며, 독립적으로 배포 가능한 서비스다.
* 마이크로서비스도 SOA(Service-Oriented-Architecture)의 한 유형이다.
* 기술적인 관점에서는 1개 이상의 네트워크 end-point를 통해 캡슐화되는 비즈니스 기능을 외부로 공개한다.

### 독립적인 배포 가능성?
> 다른 서비스를 활용하지 않고 해당 마이크로서비스에만 변경하여 배포가 가능하다는 개념이다.

* 이를 위해서는 낮은 결합도를 가져야 한다는 전제조건이 따른다.

### 기존의 3-tier 아키텍처에 대해
* 대표적으로 웹 기반 사용자 인터페이스(UI) - 백엔드 애플리케이션 - DB(데이터) 의 3-tier 아키텍처가 있다.
* 이러한 아키텍처의 근원은 콘웨이의 법칙에 따른 결과물이다.
  * "불가피하게 조직의 커뮤니케이션 구조를 본떠 시스템 구조를 만든다."
  * 과거 IT 조직의 경우 FE - BE - DBA로 팀을 구성했다.
  
* 3-tier 아키텍처의 경우 기술 관점에서 응집도는 높으나, 비즈니스 기능 관점에서는 낮다.
  * 비즈니스 기능이 변경되면 여러 layer가 함께 변경해야 하는 구조이기 때문이다.
  * 비즈니스 도메인 단위로 변화가 쉽게 일어나니까, 이를 중심으로 팀을 조직화하면 어떨까?

### MSA의 장점 & 단점

장점 :
* 독립적인 배포가 가능하다는 점.
* 서비스의 병렬 개발 작업이 가능하다.
* 기술에 중립적이다 (=프로세스 격리를 통한 다양한 기술을 선택적으로 적용할 수 있다).
* 유연성을 제공한다.

단점 : 
* 네트워크 간의 통신에 따른 소요 시간 예측의 어려움
* 패킷 손실, 네트워크 연결 끊김 등에 대비해야 함
* 기존의 단일 프로세스 모놀리스 아키텍처의 경우 Transaction을 이용할 수 있으나, 시스템의 복잡도가 올라가며 고려사항이 많아짐.

### 모놀리스(Monolith)란?
* 이 책에서의 모놀리스란, 배포 단위(unit of deployment)를 말한다.
* 모놀리스 시스템은 크게 단일 프로세스 시스템, 분산 모놀리스 시스템, 외부 블랙박스 시스템이 예가 된다.

### 단일 프로세스 모놀리스
* 모놀리스 아키텍처를 말할 때 가장 일반적으로 떠오르는 아키텍처이고, 모든 코드가 단일 프로세스로 배포되는 시스템이다.

### 모듈식 모놀리스
* 단일 프로세스는 별도의 모듈로 구성되어 있으며, 각 모듈은 독립적으로 동작하나 배포를 위해서는 결합되어야 한다.
* 병렬 작업이 가능하면서도 배포 고려사항이 msa에 비해 훨씬 단순화된다는 장점이 있다.
* 모듈식 모놀리스의 단점은 프로덕션 코드의 모듈화에 비해 DB를 분리하는 것이 어렵다는 점이다.
* 작가의 경험론적인 관점에서, 분산 모놀리스는 분산 시스템의 단점과 단일 프로세스 모놀리스의 단점 역시 가질 수 있다고 한다.
  * 주로 서비스의 경계 지점에서 변경이 발생하기에 결합도가 매우 높아질 수 있다.

### 모놀리스의 문제점
* 결합도가 높아진다는 점이 가장 큰 단점이다
  * 특히 배포 결합도의 경우에는 더 그렇다
* 여러 사람들과 여러 조직이 협업을 하는 경우에 각 구성원이 원하는 개발 방향이 다를 것이다.
  * 이러한 경우 어떤 조직이 어떤 서비스를 관리하고, 누가 의사결정을 하는지에 대해 혼란이 가중될 수 있다.
  * MSA의 경우에는 비즈니스 도메인을 중심으로 구체적인 boundary를 제공하므로 유연성이 뛰어나다.

### 모놀리스의 장점
* 배포 토폴로지의 간단성, 모니터링, 통합테스트의 단순화라는 이점도 있다.

### 결합도에 대해 : (1) 구현 결합도
음반 판매 회사에서 주문 도메인과 추천 도메인이 있고, 추천 서비스는 이전 구매를 기반으로 한다.
* 기존에는 추천 서비스에서 직접 주문 DB에 접근하여 해당 정보를 얻어온다.
  * DB의 변경사항이 그대로 추천 시스템에 영향을 줄 수 있다.
* (개선) 주문 시스템에서 API를 만들어 추천 서비스는 해당 API를 거쳐 가져오도록 한다.

### (2) 시간적 결합도
* 분산 환경 + 동기식 호출의 경우 직면할 수 있는 문제이다
* 한 서비스의 API에서 필요한 정보가 다른 여러 서비스를 통해 가져와야 하는 경우, 동기식 HTTP 호출을 이용하면 통신 시간의 제약이 있다.
* 이에 대한 해결책으로 캐싱을 사용하거나, 메세지 브로커를 통한 비동기 전송을 고려할 숭 ㅣㅆ다.

### (3) 배포 결합도
* 단일 프로세스 모놀리스 아키텍처의 경우 모듈 중 한 곳에서 단 한줄의 코드가 변경되더라도, 전체 시스템이 함께 재 배포되어야 한다.
* 큰 프로세스를 독립적으로 배포 가능한 마이크로서비스로 분해해 배포 범위를 줄일 수 있다.
* 릴리즈 범위가 작을수록 출시가 쉽고, 안전하며, 빠른 피드백을 얻을 수 있다. 

### Outro.
* 비즈니스 도메인을 중심으로 서비스를 모델링하면 여러 장점을 얻을 수 있고, 이를 구현하기 위해 DDD(도메인 주도 설계) 가 등장한다.
  * 더 깊이있는 학습을 위해서는 DDD와 관련된 여러 서적을 참고할 것.



